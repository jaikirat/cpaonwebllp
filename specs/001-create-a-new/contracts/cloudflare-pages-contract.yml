# Cloudflare Pages Contract
# Defines the expected behavior and configuration for Cloudflare Pages deployment

version: '1.0'
name: 'Cloudflare Pages Deployment'
description: 'Contract specification for Cloudflare Pages hosting and deployment'

# Project Configuration Contract
project_setup:
  connection:
    source: 'github'
    repository: '[organization]/[repository-name]'
    integration_method: 'github_app'
    
  build_configuration:
    framework: 'next.js'
    build_command: 'npm run build'
    build_output_directory: '.next'
    root_directory: ''
    
  environment_variables:
    production:
      - name: 'NODE_ENV'
        value: 'production'
      - name: 'NEXT_TELEMETRY_DISABLED'  
        value: '1'
        
    preview:
      - name: 'NODE_ENV'
        value: 'development'

# Deployment Pipeline Contract
deployment_pipeline:
  production_deployment:
    trigger: 'push_to_main'
    branch: 'main'
    build_process:
      - step: 'clone_repository'
        timeout: '30s'
      - step: 'install_dependencies'
        command: 'npm ci'
        timeout: '300s'  
      - step: 'build_application'
        command: 'npm run build'
        timeout: '600s'
      - step: 'deploy_assets'
        timeout: '120s'
        
    success_criteria:
      - build_exit_code: 0
      - deployment_status: 'success'
      - url_accessibility: 'https://cpaonweb.com'
      - ssl_certificate: 'valid'
      
  staging_deployment:
    trigger: 'push_to_staging'
    branch: 'staging'
    url: 'https://staging.cpaonweb.com'
    alias_configuration:
      type: 'branch_alias'
      branch: 'staging'
      
  preview_deployments:
    trigger: 'pull_request'
    branches: 'all_except_main_staging'
    url_pattern: 'https://[commit-hash].[project-name].pages.dev'
    retention: '30_days'
    automatic_deletion: true

# Domain Configuration Contract
domain_setup:
  custom_domains:
    production:
      domain: 'cpaonweb.com'
      ssl: 'cloudflare_universal'
      redirect_www: true
      
    staging:
      domain: 'staging.cpaonweb.com'  
      ssl: 'cloudflare_universal'
      
  dns_configuration:
    required_records:
      - type: 'CNAME'
        name: 'cpaonweb.com'
        value: '[project-name].pages.dev'
      - type: 'CNAME'
        name: 'www.cpaonweb.com'
        value: '[project-name].pages.dev'
      - type: 'CNAME'
        name: 'staging.cpaonweb.com'
        value: '[project-name].pages.dev'

# Performance Contract
performance_requirements:
  build_performance:
    maximum_build_time: '10_minutes'
    typical_build_time: '3_minutes'
    cache_strategy: 'aggressive'
    
  runtime_performance:
    global_cdn: true
    edge_locations: 'worldwide'
    cache_headers:
      static_assets: 'max-age=31536000'
      html_pages: 'max-age=0, must-revalidate'
      
  availability:
    uptime_sla: '99.9%'
    response_time: '<200ms_p95'
    concurrent_requests: 'unlimited'

# Security Contract  
security_configuration:
  ssl_settings:
    mode: 'full_strict'
    certificate: 'universal_ssl'
    min_tls_version: '1.2'
    
  access_control:
    ip_restrictions: 'none' # can be configured if needed
    geo_restrictions: 'none' # can be configured if needed
    bot_protection: 'medium'
    
  headers:
    security_headers:
      - 'X-Frame-Options: DENY'
      - 'X-Content-Type-Options: nosniff' 
      - 'Referrer-Policy: strict-origin-when-cross-origin'
      - 'Permissions-Policy: camera=(), microphone=(), geolocation=()'

# Monitoring Contract
monitoring_and_analytics:
  web_analytics:
    provider: 'cloudflare_web_analytics'
    privacy_compliant: true
    
  deployment_notifications:
    channels:
      - 'github_commit_status'
      - 'cloudflare_dashboard'
      - 'email' # optional
      
  metrics_tracking:
    - 'deployment_frequency'
    - 'build_success_rate'
    - 'deployment_duration'
    - 'error_rates'

# Rollback Contract
rollback_procedures:
  automatic_rollback:
    enabled: false # manual control preferred
    
  manual_rollback:
    methods:
      primary: 'promote_previous_deployment'
      secondary: 'git_revert_and_rebuild'
      
    rollback_targets:
      - 'previous_successful_deployment'
      - 'specific_deployment_by_id'
      
    rollback_time: '<60_seconds'

# Integration Contract
external_integrations:
  github_integration:
    status_checks: true
    deployment_status_updates: true
    pr_preview_comments: true
    
  webhook_endpoints:
    deployment_success:
      url: 'optional_webhook_url'
      events: ['deployment.success']
      
    deployment_failure:
      url: 'optional_webhook_url' 
      events: ['deployment.failed']

# Limits and Quotas
service_limits:
  builds_per_month: '500' # Free tier limit
  bandwidth_per_month: '100GB' # Free tier limit
  concurrent_builds: '1' # Free tier limit
  
  file_limits:
    max_file_size: '25MB'
    max_files_per_deployment: '20000'
    
  function_limits: # if using Cloudflare Functions
    cpu_time: '10ms'
    memory: '128MB'

# Backup and Recovery
backup_strategy:
  deployment_history:
    retention: '90_days'
    max_deployments: '100'
    
  source_code_backup:
    primary: 'github_repository'
    frequency: 'continuous'
    
  configuration_backup:
    settings_export: 'manual'
    environment_variables: 'manual_documentation'